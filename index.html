<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>PDF</title>
</head>
<body>
  <h1>PDF</h1>
  <input id="files" type="file" accept="image/*" multiple style="display:none">
  <button id="btnOpen">画像を選択</button>
  <input id="pdfName" type="text" value="名前.pdf">
  <button id="btnMake">作成</button>

  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script>
    const f = document.getElementById('files');
    const n = document.getElementById('pdfName');
    const bOpen = document.getElementById('btnOpen');
    const bMake = document.getElementById('btnMake');

    bOpen.onclick = () => f.click();

    bMake.onclick = async () => {
      if (!f.files.length) return;

      bMake.disabled = true;
      bMake.textContent = "作成中...";

      const pdf = await PDFLib.PDFDocument.create();

      for (let i = 0; i < f.files.length; i++) {
        const buf = await f.files[i].arrayBuffer();
        let img;
        try {
          img = await pdf.embedJpg(buf);
        } catch {
          try {
            img = await pdf.embedPng(buf);
          } catch(e) {}
        }
        if (!img) continue;

        const page = pdf.addPage([img.width, img.height]);
        page.drawImage(img, {x:0,y:0,width:img.width,height:img.height});
      }

      const bytes = await pdf.save();
      const blob = new Blob([bytes], {type:'application/pdf'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = n.value.trim() || "out.pdf";
      a.click();

      bMake.disabled = false;
      bMake.textContent = "作成";
    };
  </script>
</body>
</html>
