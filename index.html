<script>
  const fileInput   = document.getElementById('files');
  const nameInput   = document.getElementById('name');
  const makeButton  = document.getElementById('makeBtn');
  const openButton  = document.getElementById('openBtn');

  // 画像選択ボタンを押したらファイル選択ダイアログを開く
  openButton.onclick = () => {
    fileInput.click();
  };

  // PDF作成処理
  makeButton.onclick = async () => {
    if (!fileInput.files.length) return;

    makeButton.disabled = true;
    makeButton.textContent = '作成中...';

    const pdfDoc = await PDFLib.PDFDocument.create();

    for (const file of fileInput.files) {
      const buffer = await file.arrayBuffer();
      let image;

      // jpg/pngを順番にトライ
      try {
        image = await pdfDoc.embedJpg(buffer);
      } catch {
        try {
          image = await pdfDoc.embedPng(buffer);
        } catch {}
      }
      if (!image) continue;

      const page = pdfDoc.addPage([image.width, image.height]);
      page.drawImage(image, { x: 0, y: 0, width: image.width, height: image.height });
    }

    const pdfBytes = await pdfDoc.save();
    const blob = new Blob([pdfBytes], { type: 'application/pdf' });

    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = nameInput.value.trim() || 'output.pdf';
    link.click();

    makeButton.disabled = false;
    makeButton.textContent = '作成';
  };
</script>
